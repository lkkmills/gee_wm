/**** Start of imports. If edited, may not auto-convert in the playground. ****/
var imageCollection = ee.ImageCollection("LANDSAT/LC08/C01/T1_TOA"),
    kenya_point = 
    /* color: #d63000 */
    /* shown: false */
    ee.Geometry({
      "type": "GeometryCollection",
      "geometries": [
        {
          "type": "Point",
          "coordinates": [
            34.65889518047822,
            -1.2942696462074224
          ]
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                36.957116560116425,
                -1.2958974843632431
              ],
              [
                36.96278138555588,
                -1.3005311518456177
              ],
              [
                36.9747976819426,
                -1.3014750460314817
              ],
              [
                36.98003335393967,
                -1.293666456253865
              ],
              [
                36.9751410046965,
                -1.2872307872661841
              ],
              [
                36.960635618343964,
                -1.2883463043900576
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        }
      ],
      "coordinates": []
    }),
    task_mean = 
    /* color: #0b4a8b */
    /* shown: false */
    ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[37.03812589676628, -1.2994270349436026],
                  [37.022590541360856, -1.2982257139729632],
                  [37.028856181937414, -1.3086085405914378],
                  [37.03778257399616, -1.30491878066499]]]),
            {
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[37.053172635582165, -1.3134716514021445],
                  [37.05403094246693, -1.3058990719276593],
                  [37.042400884178356, -1.3035822441815632],
                  [37.04126362755604, -1.3116267757923987]]]),
            {
              "system:index": "1"
            })]),
    task_mean_2 = 
    /* color: #ff0000 */
    /* shown: false */
    ee.Geometry.Polygon(
        [[[37.041308771790355, -1.3115784100620074],
          [37.05315340680012, -1.3134661897759985],
          [37.054011713684886, -1.3059150623838576],
          [37.04242457074055, -1.303598234652481]]]),
    table = ee.FeatureCollection("users/lkmills/farm_boundaries_gee"),
    table2 = ee.FeatureCollection("users/lkmills/farm_boundaries_gee"),
    table3 = ee.FeatureCollection("users/lkmills/farm_boundaries_gee"),
    geometry = 
    /* color: #00ff00 */
    /* shown: false */
    ee.Geometry.MultiPoint(),
    table4 = ee.FeatureCollection("users/lkmills/farm_boundaries_gee"),
    table5 = ee.FeatureCollection("users/lkmills/farm_boundaries_gee"),
    geometry2 = 
    /* color: #ff00ff */
    /* shown: false */
    ee.Geometry.MultiPolygon(
        [[[[34.69041996896249, -1.3836516410877406],
           [34.69728642404061, -1.385196142500696],
           [34.69728642404061, -1.3877703092844669],
           [34.70089131295663, -1.3869122540009222],
           [34.70689946114999, -1.3887999752137752],
           [34.71582585275155, -1.389143197090537],
           [34.72063237130624, -1.391545748831135],
           [34.72681218087655, -1.3924038024313394],
           [34.72904377877694, -1.391888970308686],
           [34.732477006316, -1.391888970308686],
           [34.73436528146249, -1.3912025273036361],
           [34.73488026559335, -1.3893148080102098],
           [34.7321336835621, -1.3884567532871677],
           [34.7321336835621, -1.3872554761516822],
           [34.7350519269703, -1.3867406429068785],
           [34.73556691110116, -1.382965195692453],
           [34.73779850900155, -1.3810774698319572],
           [34.737455186247644, -1.373354939355868],
           [34.73848515450936, -1.3663188343041475],
           [34.73659687936288, -1.362200129094581],
           [34.737455186247644, -1.3579098036816846],
           [34.73333531320077, -1.3529330166638542],
           [34.7350519269703, -1.3503588124736943],
           [34.734193620085534, -1.3486426748319928]]],
         [[[34.70913105905038, -1.3440090971591063],
           [34.707242783903894, -1.3446955536661325],
           [34.705697831511316, -1.3429794120368046],
           [34.70415287911874, -1.3429794120368046],
           [34.702951249480066, -1.3445239395574702],
           [34.7050111860035, -1.3482994471583905],
           [34.70363789498788, -1.351731721714718],
           [34.700204667448816, -1.3482994471583905],
           [34.69642811715585, -1.3575665773193484],
           [34.701234635710534, -1.3604839998447988],
           [34.699003037810144, -1.3616852904479104],
           [34.699003037810144, -1.3663188343041475],
           [34.69780140817147, -1.3670052844864242],
           [34.69608479440194, -1.3692362462229186],
           [34.69385319650155, -1.3694078585782303],
           [34.69316655099374, -1.3712955936753242],
           [34.69385319650155, -1.3735265514158461],
           [34.693509873747644, -1.3755858951738844],
           [34.690763291716394, -1.3783316840859718],
           [34.6911066144703, -1.3809058583157139],
           [34.690763291716394, -1.3834800297575345],
           [34.73488026559335, -1.3481278333034346],
           [34.73333531320077, -1.3462400801009187]]],
         [[[34.73299199044686, -1.3460684661009041],
           [34.73230534493905, -1.3426361835662821],
           [34.729902085661706, -1.3414348835400267],
           [34.727155503630456, -1.3457252380646547],
           [34.72131901681405, -1.3448671677627215],
           [34.716684159636316, -1.3424645693129427],
           [34.71239262521249, -1.3440090971591063]]],
         [[[34.79101353585702, -1.3656323839257065],
           [34.79479008614999, -1.3709523692228982],
           [34.80440312325936, -1.3695794709212523],
           [34.80268650948983, -1.3675201219943418],
           [34.8064630597828, -1.365117546013197],
           [34.8064630597828, -1.3623717419523567],
           [34.796850022673425, -1.3609988387479748],
           [34.79221516549569, -1.3582530299952817],
           [34.789640244841394, -1.3591110955659491],
           [34.78655034005624, -1.3628865804523274]]],
         [[[34.62415867745858, -1.333197381784956],
           [34.64046650826913, -1.3380025945026208],
           [34.651281175017175, -1.3441807113039508],
           [34.655744370817956, -1.3414348835400267],
           [34.660035905241784, -1.3455536240284198],
           [34.66295414864999, -1.338860667212679],
           [34.66415577828866, -1.3380025945026208],
           [34.665529069304284, -1.340061968502149],
           [34.66484242379647, -1.343665868833223],
           [34.668275651335534, -1.3536194706534714],
           [34.675485429167566, -1.3601407738483027],
           [34.68286686837655, -1.3596259347620288],
           [34.68578511178475, -1.3553356047770593],
           [34.69814473092538, -1.3495007438042126],
           [34.69865971505624, -1.3469265359801543],
           [34.69505482614022, -1.3422929550475682],
           [34.69041996896249, -1.3412632692024025],
           [34.689218339323816, -1.3421213407701456],
           [34.68664341866952, -1.3368012922043295],
           [34.683210191130456, -1.3302799266284013],
           [34.68218022286874, -1.3234153126655592],
           [34.682008561491784, -1.3165506797023632],
           [34.68733006417733, -1.311917041760726],
           [34.690248307585534, -1.3055672276863532],
           [34.68681508004647, -1.3024781231436322],
           [34.67943364083749, -1.3005903351694732],
           [34.67634373605233, -1.3011051865752825],
           [34.67359715402108, -1.306940161820828],
           [34.67479878365975, -1.3098576443635108],
           [34.67016392648202, -1.3117454253756644],
           [34.659520921110925, -1.3198113827227451],
           [34.65162449777108, -1.3263327759270833],
           [34.64836293160897, -1.3318244621414956],
           [34.645788010954675, -1.3311380020328856],
           [34.64389973580819, -1.3311380020328856],
           [34.644071397185144, -1.329421850925492],
           [34.64698964059335, -1.3263327759270833],
           [34.6471613019703, -1.3213559247671594],
           [34.64441471993905, -1.3122602744955199],
           [34.641324815153894, -1.3081414785728191],
           [34.62639027535897, -1.308484711824911],
           [34.618322190642175, -1.3096860278373088],
           [34.61025410592538, -1.3177519918381864],
           [34.60270100533944, -1.3239301593730657],
           [34.60527592599374, -1.3297650812424535],
           [34.616090592741784, -1.3321676921240917]]],
         [[[34.663984116911706, -1.2906681058141702],
           [34.66381245553475, -1.283460146970278],
           [34.66312581002694, -1.2760805490124059],
           [34.66089421212655, -1.279512922796709],
           [34.657804307341394, -1.2903248701411163],
           [34.65986424386483, -1.2947869302739652]]],
         [[[34.66707402169686, -1.275565692549413],
           [34.66896229684335, -1.2767670241360838],
           [34.677545365691, -1.274021122542491],
           [34.67960530221444, -1.2704171222604506],
           [34.68063527047616, -1.2687009298820775],
           [34.679261979460534, -1.2661266391803976],
           [34.67308216989022, -1.266984736365244],
           [34.67188054025155, -1.2687009298820775],
           [34.67308216989022, -1.270931979751717],
           [34.66964894235116, -1.2705887414355967]]],
         [[[34.661237534880456, -1.2664698780884318],
           [34.66570073068124, -1.2693874069701168],
           [34.66741734445077, -1.2683576912697332],
           [34.667245683073816, -1.2654401612279853],
           [34.665014085173425, -1.2628658672891624]]],
         [[[34.64492970406991, -1.27024550307388],
           [34.64939289987069, -1.273849503595645],
           [34.65196782052499, -1.2717900753424183],
           [34.655744370817956, -1.272133313498811],
           [34.66261082589608, -1.2688725491711639],
           [34.660550889372644, -1.2676712139084971],
           [34.651796159148034, -1.264582063532011],
           [34.64784794747811, -1.2692157877151897]]],
         [[[34.678232011198816, -1.2800277784685452],
           [34.679261979460534, -1.2820872001217138],
           [34.68458348214608, -1.279169685624749],
           [34.687501725554284, -1.2736778846373873],
           [34.68509846627694, -1.2726481706477988],
           [34.679261979460534, -1.2735062656676797],
           [34.68115025460702, -1.2759089302028583]]],
         [[[34.67891865670663, -1.2760805490124059],
           [34.678232011198816, -1.2789980670215428],
           [34.68029194772225, -1.2764237865971513]]],
         [[[34.69265156686288, -1.2807142525368387],
           [34.68956166207772, -1.2836317652745373],
           [34.689733323454675, -1.287922219133562],
           [34.6911066144703, -1.291182959236909],
           [34.6936815351246, -1.292384283484348],
           [34.69127827584725, -1.2934139895299035],
           [34.691449937224206, -1.2951301653438205],
           [34.688703355192956, -1.2951301653438205],
           [34.68784504830819, -1.2983908961872623],
           [34.69041996896249, -1.3004503029746202],
           [34.699003037810144, -1.2985625134836547],
           [34.697973069548425, -1.2947869302739652],
           [34.70277958810311, -1.291182959236909],
           [34.70140629708749, -1.274021122542491],
           [34.69539814889413, -1.2736778846373873],
           [34.69265156686288, -1.27831159249399]]],
         [[[34.70037632882577, -1.305770429391242],
           [34.70707112252694, -1.3011367715304651],
           [34.70535450875741, -1.2961598702744388],
           [34.70192128121835, -1.2968463399955883],
           [34.697458085417566, -1.3030245590954903]]],
         [[[34.60149937570077, -1.3157241840224232],
           [34.61403065621835, -1.3069717467027817],
           [34.60973912179452, -1.294100459994832],
           [34.61403065621835, -1.2928991365593376],
           [34.61523228585702, -1.2971895747863433],
           [34.61815052926522, -1.291869430304998],
           [34.620038804411706, -1.291526194794127],
           [34.62141209542733, -1.2965031051582825],
           [34.6277635663746, -1.289810016544681],
           [34.632570084929284, -1.279684541365476],
           [34.63771992623788, -1.2777967364778653],
           [34.64218312203866, -1.2741927414778993],
           [34.64510136544686, -1.2613212897016552],
           [34.64046650826913, -1.260806430302018],
           [34.63085347115975, -1.266641497525401],
           [34.63291340768319, -1.2596050913069832],
           [34.63119679391366, -1.2568591715251465],
           [34.62570362985116, -1.258746991685692],
           [34.6167772382496, -1.2511957028635565],
           [34.61094075143319, -1.2505092209817217],
           [34.60922413766366, -1.254628109576117],
           [34.60270100533944, -1.2565159313492669],
           [34.59943943917733, -1.2644104439587613],
           [34.59600621163827, -1.270760360599369],
           [34.593087968230066, -1.279684541365476],
           [34.59274464547616, -1.289810016544681],
           [34.59205799996835, -1.2959882528150748],
           [34.594632920622644, -1.3028529421025483]]],
         [[[34.578840073942956, -1.2767670241360838],
           [34.5922296613453, -1.2692157877151897],
           [34.59755116403085, -1.263723965552344],
           [34.59154301583749, -1.254799729793645]]],
         [[[34.591371354460534, -1.2542848691073083],
           [34.58398991525155, -1.263723965552344],
           [34.578668412566, -1.275565692549413]]],
         [[[34.66055418869634, -1.2440943514993357],
           [34.65918089768071, -1.2307078865815604],
           [34.65677763840337, -1.222470028573578],
           [34.654374379126025, -1.2327673471144147],
           [34.64373137375493, -1.2293349120093224],
           [34.640641468969775, -1.2331105903817552],
           [34.6365215959229, -1.2269322048095093],
           [34.63926817795415, -1.2156051275858404],
           [34.63171507736821, -1.2077104698791614],
           [34.62055708786626, -1.219724070279206],
           [34.60974242111821, -1.2317376170469438],
           [34.60150267502446, -1.2296781557185947],
           [34.60184599777837, -1.239632204037488],
           [34.60287596604009, -1.250272697058766]]],
         [[[34.615922230688525, -1.250272697058766],
           [34.638924855200244, -1.2561077878484563],
           [34.65128447434087, -1.2454673184320975]]],
         [[[34.655404347387744, -1.2550780668894963],
           [34.6584942521729, -1.2636590624606365],
           [34.674630421606494, -1.2430646258308264],
           [34.677377003637744, -1.244780835055071],
           [34.67978026291509, -1.239632204037488],
           [34.67978026291509, -1.2344835630083841],
           [34.67531706711431, -1.2372295061339145],
           [34.67257048508306, -1.242034899760766],
           [34.669137257543994, -1.2403186887525228],
           [34.66227080246587, -1.2386024766312511],
           [34.659867543188525, -1.2492429738066644]]],
         [[[34.70072295090337, -1.2327673471144147],
           [34.69351317307134, -1.221440294541953],
           [34.68939330002446, -1.2231565177086168],
           [34.68252684494634, -1.2313943736026756],
           [34.68939330002446, -1.244780835055071]]],
         [[[34.666390675512744, -1.2331105903817552],
           [34.67154051682134, -1.2341403199181622],
           [34.67875029465337, -1.23105113011421],
           [34.67566038986821, -1.2228132731630368],
           [34.67154051682134, -1.218694335196077]]],
         [[[34.67685933343468, -1.2177919569597901],
           [34.67926259271202, -1.218135202146239],
           [34.679691746154404, -1.2150459938956295],
           [34.6767735027462, -1.213415577005206],
           [34.67548604241905, -1.21478855971516],
           [34.67574353448448, -1.219593993700668]]],
         [[[34.661924793639756, -1.2231980635608657],
           [34.66201062432823, -1.2243136080134263],
           [34.6643280529171, -1.2265446955255663],
           [34.66475720635948, -1.2243994191059424],
           [34.66364140740929, -1.2202804835703895],
           [34.662868931213, -1.2202804835703895]]],
         [[[34.62029690972862, -1.1960816106173164],
           [34.623215153136826, -1.1968539183926838],
           [34.62553258172569, -1.1947086184801219],
           [34.62304349175987, -1.1911903229985465],
           [34.62081189385948, -1.1928207531712847]]],
         [[[34.648450677483936, -1.195385201665739],
           [34.64064008483257, -1.1927250281026063],
           [34.64536077269878, -1.1899790397919152],
           [34.64209920653667, -1.1879195467645425],
           [34.64415914306011, -1.1827708074860306],
           [34.64278585204448, -1.178823434234457],
           [34.64003927001323, -1.1787376217102459],
           [34.63935262450542, -1.1846586796661762],
           [34.64012510070171, -1.2008771647338234],
           [34.64587575682964, -1.2099732042673674]]],
         [[[34.643448011492396, -1.2154283394171939],
           [34.6463662549006, -1.2110519556353974],
           [34.644220487688685, -1.208477608931681],
           [34.64078726014962, -1.2141411684517442]]],
         [[[34.644477979754114, -1.2276993383915258],
           [34.64533628663888, -1.2279567713352302],
           [34.64576544008126, -1.2289006919166703],
           [34.64902700624337, -1.2304452885120627],
           [34.64911283693185, -1.2277851493755085],
           [34.65091528138986, -1.2260689291726254],
           [34.65555013856759, -1.2288148809684878],
           [34.65537847719064, -1.2200621498083277],
           [34.656923429583216, -1.220748639558575],
           [34.65932668886056, -1.218002679506934],
           [34.6588117047297, -1.2164580757478638],
           [34.65726675233712, -1.2152567166572321],
           [34.65606512269845, -1.2158573962693713],
           [34.654949323748255, -1.2137121113270313],
           [34.652717725847864, -1.2100222172470487],
           [34.65005697450509, -1.20727624630127],
           [34.64885534486642, -1.2081343625200442],
           [34.6492844983088, -1.2102796518807981],
           [34.64731039247384, -1.2099364056970416],
           [34.6437913342463, -1.2199763385772284],
           [34.64464964113107, -1.222379052012761],
           [34.6437913342463, -1.226240551242445]]],
         [[[34.66404737672677, -1.208649232121234],
           [34.66739477357736, -1.2036721552270269],
           [34.6657639904963, -1.2011836133710747],
           [34.6628457470881, -1.2007545542012017],
           [34.6628457470881, -1.198180197768601],
           [34.664219038103724, -1.1965497707763413],
           [34.665420667742396, -1.195605838916756],
           [34.66378988466134, -1.1944902826642996],
           [34.661386625384, -1.1988666930540568],
           [34.658725874041224, -1.1978369500613588],
           [34.65563596925607, -1.2019559197070504]]],
         [[[34.67478158343743, -1.1956792357978026],
           [34.67478158343743, -1.1924183778743824],
           [34.67357995379876, -1.1919893173334868],
           [34.669631742128836, -1.1948211156667425]]],
         [[[34.76759790557647, -1.1731023873332718],
           [34.77000116485382, -1.1760200175691202],
           [34.77137445586944, -1.1727591365171264],
           [34.76982950347686, -1.1717293838161669]]]]),
    roi = 
    /* color: #ff9999 */
    /* shown: false */
    ee.Geometry.Point([34.63171603825686, -1.2348997705556235]),
    geometry3 = 
    /* color: #d63000 */
    /* shown: false */
    /* displayProperties: [
      {
        "type": "rectangle"
      }
    ] */
    ee.Geometry.Polygon(
        [[[34.503922721959576, -1.1011337541554518],
          [34.503922721959576, -1.4416255805613656],
          [34.844498893834576, -1.4416255805613656],
          [34.844498893834576, -1.1011337541554518]]], null, false),
    table6 = ee.FeatureCollection("users/lkmills/ethiopia_polys"),
    farm_boundaries = ee.FeatureCollection("users/lkmills/farm_boundaries_gee");
/***** End of imports. If edited, may not auto-convert in the playground. *****/
// Import Landsat 8 dataset
var l8 = ee.ImageCollection('LANDSAT/LC08/C01/T1_TOA');

// Spatial filtering (filterBounds, by geometry point)
var spatialFiltered = l8.filterBounds(kenya_point);
//print('spatialFiltered', spatialFiltered);

// Temporal filtering (filterDate, by date, August 2019)
var temporalFiltered = spatialFiltered.filterDate('2019-08-01', '2019-08-31');
//print('temporalFiltered', temporalFiltered);

// Sort and pull first image, first = least cloudy, another way to filter
var sorted = temporalFiltered.sort('CLOUD_COVER');
var scene = sorted.first();

// Result = Least cloudy image of this region in August 2019

// Condensed form. USE THIS!!!

var image = ee.Image(
  l8.filterBounds(kenya_point)
    .filterDate('2019-08-01', '2019-08-31')
    .sort('CLOUD_COVER')
    .first()
);

// Produces image
//Map.centerObject(image, 9);
Map.addLayer(image, {}, 'default RGB');

// Compute the NDVI
var nir = image.select('B5');
var red = image.select('B4');
var ndvi = nir.subtract(red).divide(nir.add(red)).rename('NDVI');
//print('ndvi',ndvi);

// Display the NDVI result
var ndviParams = {min: -1, max: 1, palette: ['blue', 'white', 'green']};
Map.addLayer(ndvi, ndviParams, 'NDVI image');

// Alternative, NDVI shortcut >> var ndvi = image.normalizedDifference(['B5', 'B4']).rename('NDVI');

var meanDict = ndvi.reduceRegion({
  reducer: ee.Reducer.mean(),
  geometry: kenya_point,
  scale: 90
});

var mean = meanDict.get('NDVI');
print('Mean NDVI', mean);
// //
// Can calculate mean NDVI this way but also given mean by INSEPCTOR

// Task: Calculate combined mean of fields in task_mean

// Polygon 1 = 0.3683650493621826
// Polygon 2 = 0.3611997663974762
// Total mean = 0.72956481576

// var meanDict = ndvi.reduceRegion({
//   reducer: ee.Reducer.mean(),
//   geometry: task_mean,
//   scale: 90
// });

// var mean = meanDict.get('NDVI');
// print('task_mean mean NDVI', mean);

// // task_mean mean NDVI = 0.288997472992128
// // 0.26541803236
// // task_mean mean NDVI with second polygon = 0.26622334617198123

// // task_mean_2 mean NDVI = 0.24183859174277123

// var meanDict_2 = ndvi.reduceRegion({
//   reducer: ee.Reducer.mean(),
//   geometry: task_mean_2,
//   scale: 90
// });

// var mean = meanDict_2.get('NDVI');
// //print('task_mean_2 mean NDVI', mean);

// // Conclusions! Each pixel has a calculated NDVI value
var CPPAA = ee.FeatureCollection('users/lkmills/_1_CPPAA_9402_NDBuffer');
Map.addLayer(CPPAA, {color: 'red'}, 'CPPAA');

var ACC = ee.FeatureCollection('users/lkmills/_5_ACC_0410_NDBuffer');
Map.addLayer(ACC, {color: 'green'}, 'ACC');

var ICRMP = ee.FeatureCollection('users/lkmills/_7_ICRMP_0714_NDBuffer');
Map.addLayer(ICRMP, {color: 'blue'}, 'ICRMP');

var SMART_SEAS = ee.FeatureCollection('users/lkmills/_11_SMART-SEAS_1420_NDBuffer');
Map.addLayer(SMART_SEAS, {color: 'purple'}, 'SMART_SEAS');

var PHL = ee.FeatureCollection('users/lkmills/geoBoundariesSimplified-3_0_0-PHL-ADM2');
Map.addLayer(PHL, {}, 'PHL');
//print(PHL);

// var meanDict = ndvi.reduceRegion({
//   reducer: ee.Reducer.mean(),
//   geometry : CPPAA,
//   scale: 90,
// });

// var mean = meanDict.get('NDVI');
// print('nuru mean NDVI', mean);

// //
// var meanDict = ndvi.reduceRegion({
//   reducer: ee.Reducer.mean(),
//   geometry: geometry2,
//   scale: 90,
// });

// Mapping NDVI function over every image in collection

var mean = meanDict.get('NDVI');
//print('geometry2 mean NDVI', mean);

var addNDVI = function(image) {
  var ndvi = image.normalizedDifference(['B5', 'B4']).rename('NDVI');
  return image.addBands(ndvi);
};

// Test the addNDVI function on a single image.
var ndvi = addNDVI(image).select('NDVI');

var withNDVI = l8.map(addNDVI);

// Create a chart of mean NDVI over time for all polygons in farm_boundaries layer
var chart = ui.Chart.image.series({
  imageCollection: withNDVI.select('NDVI'),
  region: farm_boundaries,
  reducer: ee.Reducer.mean(), // Important to specify reducer as MEAN
  scale: 30
}).setOptions({title: 'Times Series of Mean Normalized Difference Vegetation Index (NDVI) for Kenya Farms'});

// Display the chart in the console, time series of mean NDVI values
//print(chart);

// Create a chart of mean NDVI over time for all polygons in farm_boundaries layer
var chart = ui.Chart.image.series({
  imageCollection: withNDVI.select('NDVI'),
  region: roi,
  reducer: ee.Reducer.first(), // Important to specify reducer as MEAN
  scale: 30
}).setOptions({title: 'NDVI over time'});

// Display the chart in the console, time series of mean NDVI values
print(chart);

// Digression: Simple Cloud Masking for Landsat
var cloudlessNDVI = l8.map(function(image) {
  // Get a cloud score in [0, 100].
  var cloud = ee.Algorithms.Landsat.simpleCloudScore(image).select('cloud');

  // Create a mask of cloudy pixels from an arbitrary threshold.
  var mask = cloud.lte(20);

  // Compute NDVI.
  var ndvi = image.normalizedDifference(['B5', 'B4']).rename('NDVI');

  // Return the masked image with an NDVI band.
  return image.addBands(ndvi).updateMask(mask);
});

//print(ui.Chart.image.series({
  //imageCollection: cloudlessNDVI.select('NDVI'),
  //region: farm_boundaries,
  //reducer: ee.Reducer.mean(),
  //scale: 30
//}).setOptions({title: 'Times Series of Cloud-Masked Mean Normalized Difference Vegetation Index (NDVI) for Kenya Farms'}));

// Export satellite image
var exportimage = cloudlessNDVI.qualityMosaic('NDVI');

// Create a 3-band, 8-bit, color-IR composite to export.
var visualization = exportimage.visualize({
  bands: ['B5', 'B4', 'B3'],
  max: 0.4
});

// var bottom_left_salonga = ee.Geometry.Point([34.56507, -1.466667]);
// Map.addLayer(bottom_left_salonga, {color: 'red'}, 'bottom_left_salonga');

// var bottom_right_salonga = ee.Geometry.Point([34.75514, -1.466667]);
// Map.addLayer(bottom_right_salonga, {color: 'red'}, 'bottom_right_salonga');

// var top_left_salonga = ee.Geometry.Point([34.56507, -1.13125]);
// Map.addLayer(top_left_salonga, {color: 'red'}, 'top_left_salonga');

// var top_right_salonga = ee.Geometry.Point([34.75514,-1.13125]);
// Map.addLayer(top_right_salonga, {color: 'red'}, 'top_right_salonga');

// var ethiopia = ee.FeatureCollection('users/lkmills/ethiopia_polys');
// Map.addLayer(ethiopia, {color: 'red'}, 'ethopia');
// //print(ethiopia);

// //var centroid = farm_boundaries.centroid();
// //print(centroid);

// //var centroid_kenya = ee.Geometry.Point([34.66, -1.30]);
// //Map.addLayer(centroid_kenya, {color: 'red'}, 'centroid_kenya');
